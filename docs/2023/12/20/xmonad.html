<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>xmonad | hejohns’ jekyll site</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="xmonad" />
<meta name="author" content="Johnson He" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="As with the icecc post, I’m moving xmonad from one server to another for “less downtime”1. I’m reproducing the xmonad setup on the Dell T130 (Pentium G4600) to a container on the Lenovo P720 (dual Xeon 6142s), so I can restart other stuff w/o killing my window manager &#8617;" />
<meta property="og:description" content="As with the icecc post, I’m moving xmonad from one server to another for “less downtime”1. I’m reproducing the xmonad setup on the Dell T130 (Pentium G4600) to a container on the Lenovo P720 (dual Xeon 6142s), so I can restart other stuff w/o killing my window manager &#8617;" />
<link rel="canonical" href="http://localhost:4000/2023/12/20/xmonad.html" />
<meta property="og:url" content="http://localhost:4000/2023/12/20/xmonad.html" />
<meta property="og:site_name" content="hejohns’ jekyll site" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-12-20T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="xmonad" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Johnson He"},"dateModified":"2023-12-20T11:36:46-05:00","datePublished":"2023-12-20T00:00:00-05:00","description":"As with the icecc post, I’m moving xmonad from one server to another for “less downtime”1. I’m reproducing the xmonad setup on the Dell T130 (Pentium G4600) to a container on the Lenovo P720 (dual Xeon 6142s), so I can restart other stuff w/o killing my window manager &#8617;","headline":"xmonad","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2023/12/20/xmonad.html"},"url":"http://localhost:4000/2023/12/20/xmonad.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="hejohns&apos; jekyll site" />  <!-- see: -->
  <!-- https://codewrites.me/jekyll/katex/blog/2020/08/26/use-katex-gh-pages/ -->
  <!-- https://www.xuningyang.com/blog/2021-01-11-katex-with-jekyll/ -->
  <!-- and adjusted according to minima layout -->

  <!--KaTeX-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
              // ...options...
          });
      });
  </script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">hejohns&#39; jekyll site</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/posts.html">posts</a><a class="page-link" href="/site-construction.html">site-construction</a><a class="page-link" href="/reviews.html">reviews</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
          <h3>
            page version: December 20, 2023
          </h3>
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">xmonad</h1>
    <p class="post-meta"><time class="dt-published" datetime="2023-12-20T00:00:00-05:00" itemprop="datePublished">
        original date: Dec 20, 2023
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>As with the <a href="{$ link _posts/icecc.md %}">icecc post</a>,
I’m moving <a href="https://xmonad.org/">xmonad</a> from one server to another
for “less downtime”<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>.</p>

<p>I had all the configuration files in <a href="https://github.com/hejohns/.rc">my rc github repo</a>,
but I didn’t document what to actually do, so here we go:</p>

<ul>
  <li>Take a fresh debian container
    <ul>
      <li>You probably want to <code class="language-plaintext highlighter-rouge">adduser hejohns</code> and <code class="language-plaintext highlighter-rouge">apt install sudo</code> and  <code class="language-plaintext highlighter-rouge">adduser hejohns sudo</code>
  since we want to <code class="language-plaintext highlighter-rouge">ssh -X</code> into this box later<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup></li>
    </ul>
  </li>
  <li>Install ghc/cabal w/ ghcup
    <ul>
      <li>See <a href="https://www.haskell.org/ghcup/install/">https://www.haskell.org/ghcup/install/</a></li>
      <li>Install the required system packages (eg curl, libffi-dev, libgmp-dev, …)</li>
      <li>Do their <code class="language-plaintext highlighter-rouge">curl | sh</code> thing</li>
      <li>If this container is just for xmonad, can do a minimal ghcup install</li>
      <li>Can probably just use the default version of ghc.
  You can <code class="language-plaintext highlighter-rouge">ghcup tui</code> to install something newer, but if you pick something too bleeding edge, you might get cabal package constraint errors later</li>
    </ul>
  </li>
  <li>Install xmonad
    <ul>
      <li>See <a href="https://xmonad.org/INSTALL.html">https://xmonad.org/INSTALL.html</a></li>
      <li>Install the required system dependencies (eg libx11-dev, libxss-dev, …)</li>
      <li><code class="language-plaintext highlighter-rouge">cabal update</code></li>
      <li><code class="language-plaintext highlighter-rouge">cabal install --lib xmonad xmonad-contrib</code>
  for the libraries xmonad needs on recompile</li>
      <li><code class="language-plaintext highlighter-rouge">cabal install xmonad</code> for the actual executable</li>
    </ul>
  </li>
  <li>You still need some X infrastructure for xmonad to work
    <ul>
      <li>At the least, you need <code class="language-plaintext highlighter-rouge">apt install x11-utils</code> or else xmonad will error out on some missing executable</li>
      <li>This might be included in <code class="language-plaintext highlighter-rouge">apt install xorg</code></li>
      <li>I don’t know anything about X,
  so I don’t even know if you need an X server or not–
  but I think it didn’t work until I installed one</li>
    </ul>
  </li>
  <li>I’m lazy, so <code class="language-plaintext highlighter-rouge">xmonad --recompile</code> and wait for it to error out b/c of the missing <em>xmonad.hs</em></li>
  <li>This creates <em>~/.config/xmonad</em> for you (for create it yourself)</li>
  <li><code class="language-plaintext highlighter-rouge">git clone</code> the rc repo or equivalent
(for <em>xmonad.hs</em>, <em>.xsession</em>, and associated systemd files)</li>
  <li><code class="language-plaintext highlighter-rouge">cp</code> the <em>xmonad.hs</em> into <em>~/.config/xmonad</em></li>
  <li>Confirm that <code class="language-plaintext highlighter-rouge">xmonad --recompile</code> works now</li>
  <li><code class="language-plaintext highlighter-rouge">xmonad --replace</code> won’t work yet since the X env isn’t setup properly</li>
  <li><code class="language-plaintext highlighter-rouge">cp</code> the systemd files in rc under <em>etc/systemd/user</em> to their respective place in the actual system</li>
  <li>You probably need to <code class="language-plaintext highlighter-rouge">systemctl --user enable</code> the two services</li>
  <li><code class="language-plaintext highlighter-rouge">cp</code> the <em>xsession</em> into <em>~/.xsession</em></li>
  <li>Finally add <code class="language-plaintext highlighter-rouge">(bash ~/.xsession &gt; /dev/null 2&gt;&amp;1 &amp;)</code> or equivalent to your <em>.bashrc</em></li>
</ul>

<h2 id="summary">Summary</h2>
<p>Now, when you’re on your desktop, you can <code class="language-plaintext highlighter-rouge">ssh -X</code> into this box we just setup
and when the bashrc gets sourced on login,
the xsession file will also run and start the systemd user target to fire up
xmonad and xcompmgr.</p>

<p>Oh right, so you probably want to install <code class="language-plaintext highlighter-rouge">xcompmgr</code> as well.
The systemd file in the repo currently assumes it was installed with <code class="language-plaintext highlighter-rouge">nix</code>,
but you can just install it with <code class="language-plaintext highlighter-rouge">apt</code> and change the path.
(I did that just now.)</p>

<p>My desktop is a “dumb” client
(actually, it’s a minimally configured debian + xfce install),
so I can outsource the ghc and xmonad mess to another machine this way.</p>

<p>Why the fuss with systemd?
xmonad used to segfault all the time for some reason,
and having your (remote) window manager suddenly stop really sucks.
A systemd user service that automatically restarts seemed like the right solution.
(When xmonad restarts, all the tilings get reset, but at least a window manager is still running.)</p>

<p>Actually, I don’t think I’ve had xmonad segfault in a long time now,
but the principle stands.</p>
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>I’m reproducing the xmonad setup on the Dell T130 (Pentium G4600) to a container on the Lenovo P720 (dual Xeon 6142s), so I can restart other stuff w/o killing my window manager <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>I did this all as root the first time, and had to do it all over again as my own user since so much of the ghcup and X stuff is per-user. <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div><!-- use minima's column styling since I don't know css -->
  <div class="footer-col-wrapper">
      <div class="footer-col"><a href="/2023/12/19/icecc.html">prev</a></div>
      <div class="footer-col">
        <h2> related </h2>
        <ul><li><a href="/2023/12/20/xmonad.html">xmonad,</a></li><li><a href="/2023/10/10/tortoise-tts.html">tortoise text to speech (and piper),</a></li><li><a href="/2023/04/23/scripting.html">some remarks apropos scripting,</a></li><li><a href="/2024/01/08/thunderbird-and-nix.html">Thunderbird and Nix,</a></li><li><a href="/2023/05/10/linux-graphics-modules.html">multiple displays and linux graphics modules,</a></li><li><a href="/site-construction/2023/04/05/welcome-to-jekyll.html">Welcome to Jekyll!,</a></li><li><a href="/2023/12/19/icecc.html">icecc,</a></li><li><a href="/site-construction/2023/04/05/katex-test.html">latex with katex,</a></li><li><a href="/site-construction/2023/05/14/darcs.html">moving from git to darcs,</a></li><li><a href="/2023/04/10/miserliness.html">funny sayings,</a></li><li><a href="/2024/01/16/mellanox.html">Mellanox ConnectX-4 10gbe,</a></li></ul>
      </div>
      <div class="footer-col"><a href="/2024/01/08/thunderbird-and-nix.html">next</a></div>
  </div>

  <a class="u-url" href="/2023/12/20/xmonad.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <!-- I don't need this
        <p class="feed-subscribe">
          <a href="http://localhost:4000/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        -->
        <ul class="contact-list">
          <li class="p-name">Johnson He</li>
          <li><a class="u-email" href="mailto:(hejohns)α(umich)δ(edu)">(hejohns)α(umich)δ(edu)</a></li>
            <li>(the answer is yes, you should.)</li>
        </ul>
        <!-- add last-modified-time -->
        <p>site version: 2024-01-28</p>
      </div>
      <div class="footer-col">
        <p>a pure waste of space</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/hejohns" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
